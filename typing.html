<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>爪尺 米 | 米_SYNTAX_RUNNER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;500;800&family=Noto+Serif+SC:wght@700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { green: '#00FF41', dark: '#000000' },
                    fontFamily: { mono: ['"JetBrains Mono"', 'monospace'], cjk: ['"Noto Serif SC"', 'serif'] }
                }
            }
        }
    </script>
    <style>
        /* --- CORE SYSTEM UI --- */
        html { cursor: none; }
        body { background-color: #000000; color: #00FF41; overflow: hidden; cursor: none; -webkit-font-smoothing: antialiased; }
        
        /* CRT Scanline Overlay */
        body::after {
            content: " "; position: fixed; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            z-index: 999; background-size: 100% 4px; pointer-events: none; opacity: 0.1;
        }

        /* Custom Cursor */
        #cursor-dot, #cursor-ring { position: fixed; pointer-events: none; z-index: 9999; border-radius: 50%; transform: translate(-50%, -50%); transition: width 0.2s, height 0.2s; }
        #cursor-dot { width: 4px; height: 4px; background-color: #00FF41; box-shadow: 0 0 10px #00FF41; }
        #cursor-ring { width: 30px; height: 30px; border: 1px solid rgba(0, 255, 65, 0.3); }
        .cursor-hover #cursor-dot { width: 0px; height: 0px; opacity: 0; }
        .cursor-hover #cursor-ring { width: 60px; height: 60px; border: 1px dashed #00FF41; background: rgba(0, 255, 65, 0.05); }

        /* The Game Pit */
        #game-pit {
            width: 400px; height: 500px;
            border: 4px solid #00FF41; border-top: none;
            background: rgba(0, 20, 0, 0.1);
            position: relative; overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.1);
        }

        .word-block {
            position: absolute; width: 100%; text-align: center;
            font-weight: 800; font-size: 1.2rem; text-transform: uppercase;
            height: 35px; line-height: 35px; border: 1px solid rgba(0, 255, 65, 0.1);
            background: rgba(0, 10, 0, 0.98); transition: background 0.1s, transform 0.2s;
        }

        .falling { z-index: 10; border-color: #00FF41; color: #fff; text-shadow: 0 0 10px #00FF41; }
        .stacked { background: rgba(0, 255, 65, 0.05); color: #00FF41; opacity: 0.8; }

        .input-bar {
            background: #000; border: 2px solid #00FF41; color: #00FF41;
            text-align: center; font-weight: bold; font-size: 1.5rem;
            width: 400px; outline: none; text-transform: uppercase;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
        }

        .magnet-wrap { display: inline-block; transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1); }
        .glow { text-shadow: 0 0 15px #00FF41; }
    </style>
</head>
<body class="font-mono">
    <div id="cursor-dot"></div><div id="cursor-ring"></div>

    <!-- UNIVERSAL NAVIGATION BAR -->
    <nav class="fixed w-full z-50 px-8 py-4 flex justify-between items-center bg-black/80 backdrop-blur-md border-b border-green/20">
        <a href="index.html#home" class="nav-item text-xl font-cjk font-bold tracking-tighter text-green glow-text uppercase hover:bg-green/10 transition-all">[ 爪尺 米 ]</a>
        <div class="hidden md:flex space-x-10 text-[10px] tracking-widest uppercase font-bold">
            <div class="magnet-wrap"><a href="index.html#home" class="nav-item hover:bg-green hover:text-black px-2 transition-all">ROOT</a></div>
            <div class="magnet-wrap"><a href="projects.html" class="nav-item hover:bg-green hover:text-black px-2 transition-all">LABS</a></div>
            <div class="magnet-wrap"><a href="index.html#about" class="nav-item hover:bg-green hover:text-black px-2 transition-all">INFO</a></div>
            <div class="magnet-wrap"><a href="index.html#connect" class="nav-item hover:bg-green hover:text-black px-2 transition-all">NODES</a></div>
        </div>
    </nav>

    <main class="flex flex-col items-center justify-center min-h-screen pt-20">
        <div class="flex gap-20 mb-6 items-end">
            <div><p class="text-[10px] opacity-40 uppercase">Blocks_Cleared</p><p id="score" class="text-4xl font-black glow">000</p></div>
            <div><p class="text-[10px] opacity-40 text-right uppercase">Gravity</p><p id="level" class="text-4xl font-black text-right glow">x1.2</p></div>
        </div>

        <!-- THE PIT -->
        <div id="game-pit"></div>

        <!-- INPUT -->
        <div class="mt-6 flex flex-col items-center">
            <input type="text" id="game-input" class="input-bar py-3" placeholder="AWAITING_INPUT" autocomplete="off" spellcheck="false">
            <p class="text-[10px] opacity-40 mt-4 tracking-widest uppercase">Type + Space to Purge | Space to Reboot on Overflow</p>
        </div>
    </main>

    <!-- SYSTEM OVERLAY -->
    <div id="overlay" class="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center text-center p-6 backdrop-blur-xl">
        <div class="max-w-md">
            <h1 id="overlay-title" class="text-5xl font-black mb-6 tracking-tighter glow">米_SYNTAX_RUNNER</h1>
            <p id="overlay-msg" class="text-green/50 mb-10 text-sm leading-relaxed lowercase">> INITIALIZING RANDOMIZED DATA POOL... <br> > MAX WORD LENGTH: 7 <br><br> <span class="text-green font-bold animate-pulse uppercase">PRESS [SPACE] TO EXECUTE MISSION</span></p>
            <button id="start-btn" class="border-2 border-green text-green px-16 py-4 font-bold text-xs tracking-widest hover:bg-green hover:text-black transition-all">INITIALIZE_SESSION</button>
        </div>
    </div>

    <script>
        // --- SHUFFLED API LOGIC ---
        async function fetchWords() {
            try {
                // ml=creative pulls a large variety of words
                const res = await fetch('https://api.datamuse.com/words?ml=creative&max=1000');
                const data = await res.json();
                let words = data.map(i => i.word.toUpperCase()).filter(w => w.length >= 3 && w.length <= 7 && /^[A-Z]+$/.test(w));
                
                // Fisher-Yates Shuffle for randomized word distribution
                for (let i = words.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [words[i], words[j]] = [words[j], words[i]];
                }
                return words;
            } catch (e) {
                return ["VOID", "CORE", "DISK", "LINK", "USER", "NODE", "DATA", "ROOT", "WEB", "GRID"];
            }
        }

        let pool = [], activeWord = null, stacked = [], score = 0, gameActive = false;
        let gravity = 1.2, blockHeight = 35, pitHeight = 500;

        const pit = document.getElementById('game-pit'), input = document.getElementById('game-input');
        const overlay = document.getElementById('overlay'), scoreEl = document.getElementById('score'), levelEl = document.getElementById('level');

        async function init() {
            if (gameActive) return;
            overlay.querySelector('p').innerText = "GENERATING_SHUFFLED_VECTORS...";
            pool = await fetchWords();
            overlay.classList.add('hidden');
            resetGame();
        }

        function resetGame() {
            pit.innerHTML = ''; stacked = []; score = 0; gravity = 1.2;
            scoreEl.innerText = "000"; levelEl.innerText = "x1.2";
            gameActive = true; input.disabled = false; input.value = ''; input.focus();
            activeWord = null;
            spawn();
            requestAnimationFrame(gameLoop);
        }

        function spawn() {
            if (!gameActive) return;
            if (pool.length < 10) fetchWords().then(newWords => pool = [...pool, ...newWords]);
            
            const text = pool.shift();
            const el = document.createElement('div');
            el.className = 'word-block falling'; el.innerText = text;
            el.style.top = '-40px';
            pit.appendChild(el);
            activeWord = { el, text, y: -40 };
        }

        function gameLoop() {
            if (!gameActive) return;

            if (activeWord) {
                activeWord.y += gravity;
                activeWord.el.style.top = activeWord.y + 'px';

                const currentFloor = pitHeight - (stacked.length * blockHeight);

                if (activeWord.y + blockHeight >= currentFloor) {
                    activeWord.el.className = 'word-block stacked';
                    activeWord.el.style.top = (currentFloor - blockHeight) + 'px';
                    stacked.push(activeWord);
                    activeWord = null;

                    if (stacked.length * blockHeight >= (pitHeight - 100)) {
                        gameOver();
                        return;
                    }
                    spawn();
                }
            }
            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            gameActive = false; input.disabled = true;
            overlay.classList.remove('hidden');
            document.getElementById('overlay-title').innerText = "[ STACK_OVERFLOW ]";
            document.getElementById('overlay-msg').innerHTML = `SESSION HALTED. SCORE: ${score} <br><br> <span class="animate-pulse">PRESS [SPACE] TO REBOOT</span>`;
        }

        // Global Spacebar Start/Restart
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !gameActive) {
                e.preventDefault();
                init();
            }
        });

        // Game Input Control
        input.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && gameActive) {
                e.preventDefault();
                const typed = input.value.trim().toUpperCase();
                
                // Clear active falling word
                if (activeWord && typed === activeWord.text) {
                    triggerDestroy(activeWord);
                    activeWord = null;
                    spawn();
                    updateProgress();
                }
                // Clear top of the stack
                else if (stacked.length > 0 && typed === stacked[stacked.length - 1].text) {
                    triggerDestroy(stacked.pop());
                    updateProgress();
                }
                input.value = '';
            }
        });

        function triggerDestroy(wordObj) {
            wordObj.el.style.backgroundColor = "#fff";
            wordObj.el.style.color = "#000";
            setTimeout(() => wordObj.el.remove(), 70);
        }

        function updateProgress() {
            score++;
            scoreEl.innerText = score.toString().padStart(3, '0');
            if (score % 5 === 0) {
                gravity += 0.15;
                levelEl.innerText = "x" + gravity.toFixed(1);
            }
        }

        document.getElementById('start-btn').addEventListener('click', init);

        // --- UNIVERSAL CURSOR & MAGNETS ---
        const dot = document.getElementById('cursor-dot');
        const ring = document.getElementById('cursor-ring');
        const magnets = document.querySelectorAll('.magnet-wrap');
        const navItems = document.querySelectorAll('.nav-item');

        window.addEventListener('mousemove', (e) => {
            dot.style.left = e.clientX + 'px'; dot.style.top = e.clientY + 'px';
            setTimeout(() => { ring.style.left = e.clientX + 'px'; ring.style.top = e.clientY + 'px'; }, 30);
            
            magnets.forEach(m => {
                const rect = m.getBoundingClientRect();
                const mX = rect.left + rect.width/2;
                const mY = rect.top + rect.height/2;
                const dist = Math.hypot(e.clientX - mX, e.clientY - mY);
                if(dist < 100) m.style.transform = `translate(${(e.clientX - mX) * 0.25}px, ${(e.clientY - mY) * 0.25}px)`;
                else m.style.transform = `translate(0, 0)`;
            });
        });

        navItems.forEach(i => {
            i.addEventListener('mouseenter', () => document.body.classList.add('cursor-hover'));
            i.addEventListener('mouseleave', () => document.body.classList.remove('cursor-hover'));
        });
    </script>
</body>
</html>